<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Contacto - Reformas</title>
    <link rel="stylesheet" href="css/contactanos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/25/25694.png" />

</head>
<body>

    <a href="index.html">
        <i class="fa-solid fa-circle-xmark" id="close-icon"></i>
    </a>


    <div class="container">
        <div class="content">
        <div class="left-side">
            <div class="address details">
                <i class="fas fa-map-marker-alt"></i>
                <div class="topic">Ubicaci√≥n</div>
                <div class="text-one">Calle Luis I, 86 - 3¬™ Planta</div>
                <div class="text-two">Madrid, Espa√±a</div>
            </div>
            <div class="phone details">
            <i class="fas fa-phone-alt"></i>
                <div class="topic">Tel√©fonos</div>
                <div class="text-one">(+34) 910 219 854</div>
                <div class="text-two">(+34) 658 567 273</div>
            </div>
            <div class="email details">
                <i class="fas fa-envelope"></i>
                <div class="topic">Email</div>
                <div class="text-one"> espinosa@reformasespinosa.com</div>
            </div>
        </div>

    
        <div class="right-side">
        <h2 id="titulo-reforma">SOLICITA TU REFORMA</h2>
        <p>Solicita informaci√≥n sobre nuestros servicios sin ning√∫n compromiso</p>

        <form id="reforma-form" enctype="multipart/form-data">
            <div class="input-box">
                <input type="text" id="nombre" name="nombre" placeholder="Introduce nombre" required>
            </div>
            <div class="input-box">
                <input type="text" placeholder="Introduce email" id="email" name="email" required>
            </div>
            <div class="input-box">
                <input type="telefono" id="telefono" name="telefono" placeholder="Introduce tel√©fono" required>
            </div>
            <div class="input-box">
                <input type="text" id="direccion" name="direccion" placeholder="Introduce direcci√≥n de la reforma" required>
            </div>

            <div class="custom-card-select">
                <input type="radio" id="cocina" name="tiporeforma" value="cocina" required>
                <label for="cocina">üç≥ Cocina</label>

                <input type="radio" id="ba√±o" name="tiporeforma" value="ba√±o" required>
                <label for="ba√±o">üõÅ Ba√±o</label>

                <input type="radio" id="dormitorio" name="tiporeforma" value="dormitorio">
                <label for="dormitorio">üõèÔ∏è Dormitorio</label>

                <input type="radio" id="salones" name="tiporeforma" value="salones_comedores">
                <label for="salones">üõãÔ∏è Salones y comedores</label>

                <input type="radio" id="exteriores" name="tiporeforma" value="exteriores">
                <label for="exteriores">üåø Exteriores</label>

                <input type="radio" id="oficina" name="tiporeforma" value="oficina">
                <label for="oficina">üíº Oficina</label>
            </div>


            <div class="form-group">
                <div class="input-box message-box">
                    <textarea id="descripcion" name="descripcion" rows="4" required placeholder="Haz una breve descripci√≥n sobre el proyecto"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label for="fecha-cita">Selecciona la fecha y hora de tu cita:</label>
                <input type="text" id="fecha-cita" name="fecha-cita" required>
            </div>
            
            <div class="form-group-seleted">
                    <div class="input-box-selected" style="height: auto;">
                    <label for="imagenes" class="upload-label">
                        <span class="upload-btn-text">Seleccionar im√°genes</span>
                        <input 
                        type="file" 
                        id="imagenes" 
                        name="imagenes[]" 
                        accept="image/*" 
                        multiple 
                        required 
                        class="upload-input"
                        >
                    </label>
                    </div>
                
                    <!-- Aqu√≠ aparecer√°n las previsualizaciones -->
                    <div class="preview-container" id="preview"></div>
                </div>
            
            <div class="form-group">
                <label for="privacidad" style="font-weight: normal;">
                    <input type="checkbox" id="privacidad" name="privacidad" required>
                Acepto los <a href="terminos_uso.html">t√©rminos y condiciones</a> adem√°s del tratamiento de mis datos personales.
                </label>
            </div>
    
            <div class="input-box message-box">
            
            </div>


            <div class="button">
                <input type="submit" value="Enviar proyecto">
            </div>


        </form>
        </div>
        </div>
    </div>

    

<script>
document.addEventListener('DOMContentLoaded', function () {
    const usuario = JSON.parse(localStorage.getItem('usuario'));
    const titulo = document.getElementById('titulo-reforma');

    // Mostrar el saludo personalizado si hay usuario
    if (usuario && usuario.nombre) {
        titulo.textContent = `Hola ${usuario.nombre}, solicita tu reforma`;
    }

    // Funci√≥n para sanitizar texto
    function sanitizeInput(input) {
        return input.replace(/[<>'"%;()&+]/g, '').trim();
    }

    // Evento al enviar el formulario
    document.getElementById('reforma-form').addEventListener('submit', async function (event) {
        event.preventDefault();

        // Sanitizar campos
        const nombre = sanitizeInput(document.getElementById('nombre').value);
        const email = sanitizeInput(document.getElementById('email').value);
        const telefono = sanitizeInput(document.getElementById('telefono').value);
        const direccion = sanitizeInput(document.getElementById('direccion').value);
        const descripcion = sanitizeInput(document.getElementById('descripcion').value);
        const privacidad = document.getElementById('privacidad').checked;
        const tipoReforma = document.querySelector('input[name="tiporeforma"]:checked');
        const imagenes = document.getElementById('imagenes').files;
        const fechaCita = sanitizeInput(document.getElementById('fecha-cita').value);

        if (!nombre || !email || !telefono || !direccion || !descripcion || !tipoReforma || !privacidad || !fechaCita) {
            alert("Por favor, completa todos los campos y acepta los t√©rminos.");
            return;
        }

        if (!usuario || !usuario.id) {
            alert("Debes iniciar sesi√≥n para enviar una reforma.");
            return;
        }

        const formData = new FormData();
        formData.append('usuario_id', usuario.id);
        formData.append('nombre', nombre);
        formData.append('email', email);
        formData.append('telefono', telefono);
        formData.append('direccion', direccion);
        formData.append('descripcion', descripcion);
        formData.append('tiporeforma', tipoReforma.value);
        formData.append('fecha_cita', fechaCita);

        for (let i = 0; i < imagenes.length; i++) {
            formData.append('imagenes', imagenes[i]);
        }

        try {
            const response = await fetch('http://127.0.0.1:5000/api/reformas', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (response.ok && result.message) {
                alert("Proyecto enviado con √©xito");
                document.getElementById('reforma-form').reset();
            } else {
                alert("Error: " + (result.message || "Hubo un error al enviar el proyecto."));
            }
        } catch (error) {
            console.error('Error:', error);
            alert("Error al enviar el proyecto.");
        }
    });

    // Calendario de citas
    flatpickr("#fecha-cita", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        minDate: "today",
        locale: "es"
    });
});
</script>






<script src="js/opcionescontactanos.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="js/calendario.js"></script>
    
</body>
</html>